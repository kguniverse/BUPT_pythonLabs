# Python程序设计#4作业

班级：2019211308

学号：2019211504

姓名：王乾凱

## 作业题目

基于#3作业获取的数据（No_Smoothing，非平滑数据），计算出LOWESS（局部加权回归，fraction取前后各5年的数据）结果，该结果可以与test.txt文件中的Lowess字段进行比较。

## 作业内容

程序源代码嵌入下方的code block中。

```python

import aiohttp
import asyncio
import json
import statsmodels.api as sm
import numpy as np


async def process(X:np.ndarray, Y:np.ndarray):
    lowess = sm.nonparametric.lowess
    n = np.size(X, 0);
    y_hat = lowess(Y, X, frac=10./n)[:, 1]
    
    return y_hat.tolist()
    
    
async def main(params):
    async with aiohttp.ClientSession('http://127.0.0.1:1337') as session:
        async with session.get('/data', params = params) as response:
            form = params.get('form', 'json')
            if form == 'json':
                json_str = await response.json()
                # j_data = json.loads(json_str)
                x = []
                y = []
                for data in json_str:
                   x.append(data.get('Year')) 
                   y.append(data.get('Temperature'))
                str = json.dumps(json_str, indent=4, sort_keys=True)
                
                z = await process(np.array(x), np.array(y))
                for a, b, c in zip(x, y, z):
                    print(a, b, round(c, 2))

            else:
                print(await response.text())


def test():
    key = input('input keyword (Temparature/[Year]):')
    if key == '':
        key = 'Year'
    reverse = input('want reverse sort \? (y/[N]):')
    if reverse == 'y':
        reverse = 'True'
    form = input('form \? (csv/xml/[json]):')
    if form == '':
        form = 'json'
    params = {'key': key, 'reverse': reverse, 'form': form}
    return params
loop = asyncio.get_event_loop()
loop.run_until_complete(main(test()))
```

## 代码说明

解析后打印内容为：

```
1880 -0.16 -0.08
1881 -0.07 -0.12
1882 -0.1 -0.16
1883 -0.17 -0.2
1884 -0.28 -0.23
1885 -0.33 -0.26
1886 -0.31 -0.27
1887 -0.36 -0.27
1888 -0.17 -0.26
1889 -0.1 -0.25
1890 -0.35 -0.25
1891 -0.22 -0.25
1892 -0.27 -0.26
1893 -0.31 -0.26
1894 -0.3 -0.24
1895 -0.22 -0.22
1896 -0.11 -0.2
1897 -0.11 -0.18
1898 -0.27 -0.16
1899 -0.17 -0.17
1900 -0.08 -0.2
1901 -0.15 -0.23
1902 -0.27 -0.25
1903 -0.37 -0.28
1904 -0.46 -0.31
1905 -0.26 -0.33
1906 -0.22 -0.36
1907 -0.38 -0.37
1908 -0.43 -0.39
1909 -0.48 -0.41
1910 -0.43 -0.41
1911 -0.44 -0.39
1912 -0.36 -0.35
1913 -0.34 -0.32
1914 -0.15 -0.31
1915 -0.14 -0.3
1916 -0.36 -0.29
1917 -0.46 -0.29
1918 -0.29 -0.3
1919 -0.28 -0.29
1920 -0.27 -0.28
1921 -0.19 -0.26
1922 -0.28 -0.25
1923 -0.27 -0.24
1924 -0.27 -0.23
1925 -0.22 -0.22
1926 -0.11 -0.22
1927 -0.22 -0.21
1928 -0.2 -0.2
1929 -0.36 -0.19
1930 -0.16 -0.19
1931 -0.09 -0.19
1932 -0.16 -0.18
1933 -0.29 -0.17
1934 -0.12 -0.16
1935 -0.2 -0.14
1936 -0.15 -0.11
1937 -0.02 -0.06
1938 0.0 -0.01
1939 -0.02 0.03
1940 0.13 0.07
1941 0.19 0.09
1942 0.07 0.11
1943 0.09 0.1
1944 0.2 0.07
1945 0.09 0.04
1946 -0.07 0.0
1947 -0.03 -0.04
1948 -0.11 -0.07
1949 -0.11 -0.08
1950 -0.17 -0.08
1951 -0.07 -0.07
1952 0.01 -0.07
1953 0.08 -0.07
1954 -0.13 -0.06
1955 -0.14 -0.06
1956 -0.19 -0.05
1957 0.05 -0.04
1958 0.06 -0.01
1959 0.03 0.01
1960 -0.03 0.03
1961 0.06 0.01
1962 0.03 -0.01
1963 0.05 -0.03
1964 -0.2 -0.04
1965 -0.11 -0.05
1966 -0.06 -0.06
1967 -0.02 -0.05
1968 -0.08 -0.03
1969 0.05 -0.02
1970 0.03 -0.0
1971 -0.08 0.0
1972 0.01 0.0
1973 0.16 -0.0
1974 -0.07 0.01
1975 -0.01 0.02
1976 -0.1 0.04
1977 0.18 0.08
1978 0.07 0.12
1979 0.17 0.17
1980 0.26 0.2
1981 0.32 0.21
1982 0.14 0.22
1983 0.31 0.21
1984 0.16 0.21
1985 0.12 0.22
1986 0.18 0.24
1987 0.32 0.27
1988 0.39 0.31
1989 0.27 0.33
1990 0.45 0.33
1991 0.4 0.33
1992 0.22 0.33
1993 0.23 0.33
1994 0.32 0.34
1995 0.45 0.37
1996 0.33 0.4
1997 0.46 0.42
1998 0.61 0.44
1999 0.38 0.47
2000 0.39 0.5
2001 0.54 0.52
2002 0.63 0.55
2003 0.62 0.59
2004 0.54 0.61
2005 0.68 0.62
2006 0.64 0.63
2007 0.66 0.64
2008 0.54 0.65
2009 0.66 0.66
2010 0.72 0.67
```
和原数据基本相近

